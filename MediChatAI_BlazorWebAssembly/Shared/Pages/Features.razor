@page "/features"
@using Microsoft.AspNetCore.Components.Authorization
@inject AppSettingsState AppSettings
@inject ThemeState ThemeState
@inject IJSRuntime JSRuntime
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthenticationStateProvider
@implements IDisposable

<PageTitle>Features - @AppSettings.Settings.SiteName</PageTitle>

<div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-black text-gray-900 dark:text-white transition-colors duration-300 min-h-screen">

    <!-- Hero Section with 3D Feature Icons -->
    <section class="pt-20 pb-16 px-6 relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-primary/5 via-accent/5 to-primary/5 animate-gradient-slow"></div>
        
        <!-- 3D Floating Feature Elements -->
        <div class="absolute inset-0">
            <div class="absolute top-1/6 left-1/6 w-20 h-20 bg-primary/30 rounded-lg animate-float-feature rotate-12"></div>
            <div class="absolute bottom-1/4 right-1/6 w-16 h-16 bg-accent/30 rounded-full animate-float-feature-reverse"></div>
            <div class="absolute top-1/2 left-1/2 w-12 h-12 bg-primary/20 rounded-lg animate-spin-slow"></div>
            <div class="absolute top-1/3 right-1/3 w-24 h-24 bg-accent/25 rounded-full animate-pulse-feature"></div>
        </div>

        <div class="container mx-auto text-center relative z-10">
            <div class="max-w-4xl mx-auto animate-fade-in">
                <div class="mb-6 animate-slide-down">
                    <span class="inline-block px-6 py-3 bg-gradient-to-r from-primary to-accent text-white rounded-full text-sm font-semibold uppercase tracking-wide shadow-lg animate-glow">
                        Powerful Features ‚ö°
                    </span>
                </div>
                
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-black mb-8 animate-slide-up leading-tight">
                    <span class="gradient-text bg-gradient-to-r from-primary via-accent to-primary bg-clip-text text-transparent">
                        Revolutionary Healthcare
                    </span>
                    <br>
                    <span class="text-2xl lg:text-4xl text-gray-600 dark:text-gray-300">Technology at Work</span>
                </h1>
                
                <p class="text-xl md:text-2xl text-gray-600 dark:text-gray-300 mb-12 animate-slide-up leading-relaxed">
                    Discover cutting-edge features that transform how you experience healthcare
                </p>
            </div>
        </div>
    </section>

    <!-- Interactive Feature Categories -->
    <section class="py-20 px-6">
        <div class="container mx-auto">
            @SectionHeader("Core Features", "Essential tools that power your healthcare journey", "üöÄ")
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-12 max-w-6xl mx-auto">
                @FeatureCard("AI Health Assistant", "ü§ñ", aiFeatures, "primary", "Try AI Assistant", async () => await HandleFeatureDemo("AI"))
                @FeatureCard("Emergency Response", "üö®", emergencyFeatures, "accent", "View Emergency", async () => await HandleFeatureDemo("Emergency"))
                @FeatureCard("Telemedicine", "üìπ", telemedicineFeatures, "primary", "Start Consultation", async () => await HandleFeatureDemo("Telemedicine"))
                @FeatureCard("Health Records", "üìä", recordFeatures, "accent", "Manage Records", async () => await HandleFeatureDemo("Records"))
                @FeatureCard("Voice Commands", "üé§", voiceFeatures, "primary", "Try Voice", async () => await HandleFeatureDemo("Voice"))
                @FeatureCard("Smart Analytics", "üìà", analyticsFeatures, "accent", "View Analytics", async () => await HandleFeatureDemo("Analytics"))
            </div>
        </div>
    </section>

    <!-- Interactive Technology Showcase -->
    <section class="py-20 px-6 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900">
        <div class="container mx-auto">
            @SectionHeader("Advanced Technology", "Powered by cutting-edge AI and machine learning", "üß†")
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mt-12 max-w-6xl mx-auto">
                @TechShowcaseCard("Machine Learning Engine", "üî¨", "Advanced algorithms that learn from medical data to provide personalized insights and predictions.", "primary", async () => await HandleTechDemo("ML"))
                @TechShowcaseCard("Natural Language Processing", "üí¨", "Understand and respond to medical queries in multiple languages with human-like comprehension.", "accent", async () => await HandleTechDemo("NLP"))
                @TechShowcaseCard("Computer Vision", "üëÅÔ∏è", "Analyze medical images and documents with AI-powered visual recognition technology.", "primary", async () => await HandleTechDemo("Vision"))
                @TechShowcaseCard("Predictive Analytics", "üîÆ", "Forecast health trends and potential issues before they become critical problems.", "accent", async () => await HandleTechDemo("Predictive"))
            </div>
        </div>
    </section>

    <!-- Interactive Feature Comparison -->
    <section class="py-20 px-6">
        <div class="container mx-auto">
            @SectionHeader("Feature Comparison", "See how our features stack up across different plans", "‚öñÔ∏è")
            
            <div class="max-w-6xl mx-auto">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden border border-gray-200 dark:border-gray-700">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-primary to-accent text-white">
                                <tr>
                                    <th class="px-6 py-4 text-left font-semibold">Feature</th>
                                    <th class="px-6 py-4 text-center font-semibold">Basic</th>
                                    <th class="px-6 py-4 text-center font-semibold">Premium</th>
                                    <th class="px-6 py-4 text-center font-semibold">Enterprise</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                @foreach (var feature in comparisonFeatures)
                                {
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                        <td class="px-6 py-4 font-medium">@feature.Name</td>
                                        <td class="px-6 py-4 text-center">@FeatureIcon(feature.Basic)</td>
                                        <td class="px-6 py-4 text-center">@FeatureIcon(feature.Premium)</td>
                                        <td class="px-6 py-4 text-center">@FeatureIcon(feature.Enterprise)</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Interactive Demo Section -->
    <section class="py-20 px-6 bg-gradient-to-br from-primary/5 to-accent/5 dark:from-primary/10 dark:to-accent/10">
        <div class="container mx-auto text-center">
            @SectionHeader("Try Our Features", "Experience the power of our healthcare platform", "üéÆ")
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-12 max-w-6xl mx-auto">
                @DemoCard("AI Chat Demo", "üí¨", "Chat with our AI assistant and get instant health insights", "primary", async () => await HandleDemo("chat"))
                @DemoCard("Voice Recognition", "üéôÔ∏è", "Try our multilingual voice commands and responses", "accent", async () => await HandleDemo("voice"))
                @DemoCard("Emergency Simulator", "üö®", "Experience our emergency response system", "primary", async () => await HandleDemo("emergency"))
            </div>
        </div>
    </section>

    <!-- Call to Action -->
    <section class="py-16 px-6 bg-gradient-to-r from-primary to-accent text-white relative overflow-hidden">
        <div class="absolute inset-0 bg-black/10"></div>
        <div class="container mx-auto text-center relative z-10">
            <h2 class="text-3xl md:text-4xl font-bold mb-6">Ready to Experience These Features?</h2>
            <p class="text-xl mb-8 opacity-90">Join thousands who are already transforming their healthcare experience</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                <button class="bg-white text-primary px-8 py-4 rounded-xl font-semibold hover:bg-gray-100 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105"
                        @onclick="HandleGetStarted">
                    üöÄ Get Started Now
                </button>
                <button class="border-2 border-white px-8 py-4 rounded-xl font-semibold hover:bg-white hover:text-primary transition-all duration-300"
                        @onclick="HandleViewPricing">
                    üíé View Pricing
                </button>
            </div>
        </div>
    </section>
</div>

@code {
    #region Feature Data
    private readonly List<string> aiFeatures = new()
    {
        "Natural language medical queries",
        "Symptom analysis and assessment",
        "Personalized health recommendations",
        "Drug interaction checking",
        "Medical knowledge base access"
    };

    private readonly List<string> emergencyFeatures = new()
    {
        "One-tap emergency alerts",
        "GPS location sharing",
        "Hospital finder and routing",
        "Emergency contact notification",
        "Critical medical info sharing"
    };

    private readonly List<string> telemedicineFeatures = new()
    {
        "HD video consultations",
        "Secure messaging",
        "Digital prescriptions",
        "Appointment scheduling",
        "Medical record sharing"
    };

    private readonly List<string> recordFeatures = new()
    {
        "Secure cloud storage",
        "AI-powered insights",
        "Lab result integration",
        "Medication tracking",
        "Health timeline view"
    };

    private readonly List<string> voiceFeatures = new()
    {
        "12+ language support",
        "Medical terminology recognition",
        "Voice-to-text transcription",
        "Hands-free operation",
        "Accent adaptation"
    };

    private readonly List<string> analyticsFeatures = new()
    {
        "Health trend analysis",
        "Predictive modeling",
        "Risk assessment",
        "Progress tracking",
        "Custom dashboards"
    };

    private readonly List<FeatureComparison> comparisonFeatures = new()
    {
        new() { Name = "AI Health Assistant", Basic = true, Premium = true, Enterprise = true },
        new() { Name = "Emergency Response", Basic = true, Premium = true, Enterprise = true },
        new() { Name = "Telemedicine", Basic = false, Premium = true, Enterprise = true },
        new() { Name = "Advanced Analytics", Basic = false, Premium = true, Enterprise = true },
        new() { Name = "Voice Commands", Basic = false, Premium = false, Enterprise = true },
        new() { Name = "Custom Integration", Basic = false, Premium = false, Enterprise = true },
        new() { Name = "Priority Support", Basic = false, Premium = true, Enterprise = true },
        new() { Name = "Multi-language Support", Basic = false, Premium = true, Enterprise = true }
    };

    public class FeatureComparison
    {
        public string Name { get; set; } = "";
        public bool Basic { get; set; }
        public bool Premium { get; set; }
        public bool Enterprise { get; set; }
    }
    #endregion

    #region Lifecycle Methods
    protected override void OnInitialized()
    {
        ThemeState.OnChange += OnThemeChanged;
        AppSettings.OnChange += OnSettingsChanged;
    }

    private void OnThemeChanged() => InvokeAsync(StateHasChanged);
    private void OnSettingsChanged() => InvokeAsync(StateHasChanged);
    #endregion

    #region Event Handlers
    private async Task HandleFeatureDemo(string feature)
    {
        await JSRuntime.InvokeVoidAsync("showToast", $"Launching {feature} demo...", "info");
        await Task.Delay(1000);
        
        var route = feature switch
        {
            "AI" => "/ai-assistant",
            "Emergency" => "/emergency",
            "Telemedicine" => "/telemedicine",
            "Records" => "/health-records",
            "Voice" => "/voice-commands",
            "Analytics" => "/analytics",
            _ => "/features"
        };
        
        Navigation.NavigateTo(route);
    }

    private async Task HandleTechDemo(string tech)
    {
        await JSRuntime.InvokeVoidAsync("showToast", $"Exploring {tech} technology...", "success");
    }

    private async Task HandleDemo(string demo)
    {
        await JSRuntime.InvokeVoidAsync("showToast", $"Starting {demo} demo...", "success");
        await Task.Delay(1500);
        
        var route = demo switch
        {
            "chat" => "/ai-chat-demo",
            "voice" => "/voice-demo",
            "emergency" => "/emergency-demo",
            _ => "/features"
        };
        
        Navigation.NavigateTo(route);
    }

    private async Task HandleGetStarted()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        if (authState.User?.Identity?.IsAuthenticated == true)
        {
            var role = authState.User?.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value ?? "Patient";
            var dashboardUrl = role switch
            {
                "Admin" => "/admin/dashboard",
                "Doctor" => "/doctor/dashboard",
                _ => "/patient/dashboard"
            };
            Navigation.NavigateTo(dashboardUrl);
        }
        else
        {
            Navigation.NavigateTo("/login");
        }
    }

    private void HandleViewPricing()
    {
        Navigation.NavigateTo("/services");
    }
    #endregion

    #region Component Methods
    private RenderFragment SectionHeader(string title, string subtitle, string icon) =>
    @<div class="text-center mb-16">
        <h2 class="text-4xl md:text-5xl font-bold text-primary dark:text-accent mb-4">
            <span class="text-3xl animate-bounce">@icon</span> @title <span class="text-3xl animate-bounce">@icon</span>
        </h2>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
            @subtitle
        </p>
    </div>;

    private RenderFragment FeatureCard(string title, string icon, List<string> features, string colorTheme, string buttonText, Func<Task> onClick) =>
    @<div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-xl hover-card-3d border border-gray-200 dark:border-gray-700 group relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-@(colorTheme)/5 to-@(colorTheme)/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        
        <div class="relative z-10">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-@(colorTheme) to-@(colorTheme == "primary" ? "accent" : "primary") rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg group-hover:scale-110 group-hover:rotate-12 transition-all duration-300">
                    <span class="text-4xl animate-pulse">@icon</span>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">@title</h3>
            </div>
            
            <div class="space-y-3 mb-6">
                @foreach (var feature in features)
                {
                    <div class="flex items-center space-x-3">
                        <div class="w-2 h-2 bg-@(colorTheme) rounded-full animate-pulse"></div>
                        <span class="text-gray-700 dark:text-gray-300 text-sm">@feature</span>
                    </div>
                }
            </div>
            
            <button class="w-full bg-@(colorTheme) hover:bg-@(colorTheme)/90 text-white py-3 rounded-xl font-semibold transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105"
                    @onclick="onClick">
                ‚ú® @buttonText
            </button>
        </div>
    </div>;

    private RenderFragment TechShowcaseCard(string title, string icon, string description, string colorTheme, Func<Task> onClick) =>
    @<div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-xl hover-card-3d border border-gray-200 dark:border-gray-700 group cursor-pointer"
         @onclick="onClick">
        <div class="flex items-start space-x-6">
            <div class="w-16 h-16 bg-gradient-to-br from-@(colorTheme) to-@(colorTheme == "primary" ? "accent" : "primary") rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 group-hover:rotate-6 transition-all duration-300">
                <span class="text-3xl">@icon</span>
            </div>
            <div class="flex-1">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3 group-hover:text-@(colorTheme) transition-colors">@title</h3>
                <p class="text-gray-600 dark:text-gray-300 leading-relaxed mb-4">@description</p>
                <div class="flex items-center space-x-2 text-@(colorTheme) font-semibold group-hover:underline">
                    <span>Explore Technology</span>
                    <span class="transform group-hover:translate-x-2 transition-transform">‚Üí</span>
                </div>
            </div>
        </div>
    </div>;

    private RenderFragment DemoCard(string title, string icon, string description, string colorTheme, Func<Task> onClick) =>
    @<div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-xl hover-card-3d border border-gray-200 dark:border-gray-700 group cursor-pointer"
         @onclick="onClick">
        <div class="text-center">
            <div class="w-16 h-16 bg-gradient-to-br from-@(colorTheme) to-@(colorTheme == "primary" ? "accent" : "primary") rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg group-hover:scale-125 group-hover:rotate-12 transition-all duration-300">
                <span class="text-3xl">@icon</span>
            </div>
            <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-3">@title</h3>
            <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">@description</p>
            <div class="text-@(colorTheme) font-semibold group-hover:underline">
                Try Demo ‚Üí
            </div>
        </div>
    </div>;

    private RenderFragment FeatureIcon(bool available) =>
    @<span class="text-2xl">
        @if (available)
        {
            <span class="text-green-500">‚úÖ</span>
        }
        else
        {
            <span class="text-gray-400">‚ùå</span>
        }
    </span>;
    #endregion

    public void Dispose()
    {
        ThemeState.OnChange -= OnThemeChanged;
        AppSettings.OnChange -= OnSettingsChanged;
    }
}

<style>
    /* 3D Feature Animations */
    @@keyframes float-feature {
        0%, 100% { transform: translateY(0) translateX(0) rotateZ(0deg) scale(1); }
        25% { transform: translateY(-15px) translateX(8px) rotateZ(5deg) scale(1.05); }
        50% { transform: translateY(-8px) translateX(-8px) rotateZ(-5deg) scale(0.95); }
        75% { transform: translateY(-20px) translateX(4px) rotateZ(3deg) scale(1.1); }
    }

    @@keyframes float-feature-reverse {
        0%, 100% { transform: translateY(0) translateX(0) rotateZ(0deg) scale(1); }
        25% { transform: translateY(15px) translateX(-8px) rotateZ(-5deg) scale(0.95); }
        50% { transform: translateY(8px) translateX(8px) rotateZ(5deg) scale(1.05); }
        75% { transform: translateY(20px) translateX(-4px) rotateZ(-3deg) scale(0.9); }
    }

    @@keyframes spin-slow {
        0% { transform: rotate(0deg) scale(1); }
        50% { transform: rotate(180deg) scale(1.2); }
        100% { transform: rotate(360deg) scale(1); }
    }

    @@keyframes pulse-feature {
        0%, 100% { transform: scale(1) rotateZ(0deg); opacity: 0.6; }
        50% { transform: scale(1.3) rotateZ(180deg); opacity: 1; }
    }

    @@keyframes glow {
        0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
    }

    .animate-float-feature { animation: float-feature 8s ease-in-out infinite; }
    .animate-float-feature-reverse { animation: float-feature-reverse 10s ease-in-out infinite; }
    .animate-spin-slow { animation: spin-slow 15s linear infinite; }
    .animate-pulse-feature { animation: pulse-feature 6s ease-in-out infinite; }
    .animate-glow { animation: glow 3s ease-in-out infinite; }

    .hover-card-3d {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        transform-style: preserve-3d;
    }

    .hover-card-3d:hover {
        transform: translateY(-12px) rotateX(5deg) rotateY(5deg);
        box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.25);
    }

    /* Reuse other animations */
    @@keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @@keyframes slide-down {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @@keyframes slide-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @@keyframes gradient-slow {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 0.6; }
    }

    .animate-fade-in { animation: fade-in 1s ease-out; }
    .animate-slide-down { animation: slide-down 0.8s ease-out; }
    .animate-slide-up { animation: slide-up 0.8s ease-out; }
    .animate-gradient-slow { animation: gradient-slow 8s ease-in-out infinite; }

    .gradient-text {
        background-size: 200% auto;
        animation: gradient-shift 3s linear infinite;
    }

    @@keyframes gradient-shift {
        0%, 100% { background-position: 0% center; }
        50% { background-position: 100% center; }
    }
</style>

<script>
    window.showToast = function(message, type) {
        console.log(`${type.toUpperCase()}: ${message}`);
        // Toast implementation would go here
    };
</script>