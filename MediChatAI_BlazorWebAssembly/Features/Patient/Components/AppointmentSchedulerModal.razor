@namespace MediChatAI_BlazorWebAssembly.Features.Patient.Components

<!-- Appointment Scheduling Modal -->
@if (IsVisible)
{
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50" @onclick="HandleClose">
        <div class="@(IsDarkMode ? "bg-gray-800" : "bg-white") rounded-lg shadow-xl max-w-md w-full p-6" @onclick:stopPropagation>
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <i class="fas fa-calendar-plus text-blue-500 text-2xl"></i>
                    <h3 class="text-lg font-semibold @(IsDarkMode ? "text-white" : "text-gray-900")">Schedule Appointment</h3>
                </div>
                <button @onclick="HandleClose"
                        class="@(IsDarkMode ? "text-gray-400 hover:text-white" : "text-gray-500 hover:text-gray-700") transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="space-y-4">
                <!-- Doctor Info -->
                <div class="@(IsDarkMode ? "bg-gray-700" : "bg-gray-50") rounded-lg p-3 flex items-center gap-3">
                    <img src="@DoctorImage"
                         alt="@DoctorName"
                         class="w-12 h-12 rounded-full object-cover" />
                    <div>
                        <div class="font-semibold @(IsDarkMode ? "text-white" : "text-gray-900")">@DoctorName</div>
                        <div class="text-sm @(IsDarkMode ? "text-gray-400" : "text-gray-600")">@DoctorSpecialty</div>
                    </div>
                </div>

                <!-- Appointment Date -->
                <div>
                    <label class="block text-sm font-medium @(IsDarkMode ? "text-gray-300" : "text-gray-700") mb-2">
                        Preferred Date
                    </label>
                    <input type="date"
                           @bind="AppointmentDate"
                           min="@DateTime.Now.ToString("yyyy-MM-dd")"
                           class="w-full px-3 py-2 rounded-lg @(IsDarkMode ? "bg-gray-700 text-white border-gray-600" : "bg-white text-gray-900 border-gray-300") border focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                </div>

                <!-- Appointment Time -->
                <div>
                    <label class="block text-sm font-medium @(IsDarkMode ? "text-gray-300" : "text-gray-700") mb-2">
                        Preferred Time
                    </label>
                    <select value="@AppointmentTime.ToString(@"hh\:mm")" @onchange="@((ChangeEventArgs e) => HandleTimeChange(e.Value?.ToString() ?? ""))"
                            class="w-full px-3 py-2 rounded-lg @(IsDarkMode ? "bg-gray-700 text-white border-gray-600" : "bg-white text-gray-900 border-gray-300") border focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select time...</option>
                        <option value="09:00">9:00 AM</option>
                        <option value="10:00">10:00 AM</option>
                        <option value="11:00">11:00 AM</option>
                        <option value="12:00">12:00 PM</option>
                        <option value="14:00">2:00 PM</option>
                        <option value="15:00">3:00 PM</option>
                        <option value="16:00">4:00 PM</option>
                        <option value="17:00">5:00 PM</option>
                    </select>
                </div>

                <!-- Reason -->
                <div>
                    <label class="block text-sm font-medium @(IsDarkMode ? "text-gray-300" : "text-gray-700") mb-2">
                        Reason for Visit
                    </label>
                    <textarea @bind="AppointmentReason"
                              rows="3"
                              placeholder="Briefly describe your symptoms or reason for visit..."
                              class="w-full px-3 py-2 rounded-lg @(IsDarkMode ? "bg-gray-700 text-white border-gray-600 placeholder-gray-400" : "bg-white text-gray-900 border-gray-300 placeholder-gray-500") border focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
                </div>

                <!-- Appointment Type -->
                <div>
                    <label class="block text-sm font-medium @(IsDarkMode ? "text-gray-300" : "text-gray-700") mb-2">
                        Appointment Type
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <button @onclick="@(() => AppointmentType = "InPerson")"
                                class="px-4 py-2 rounded-lg border-2 transition-all @(AppointmentType == "InPerson" ? "border-blue-500 bg-blue-500 text-white" : (IsDarkMode ? "border-gray-600 hover:border-gray-500" : "border-gray-300 hover:border-gray-400"))">
                            <i class="fas fa-hospital mr-2"></i>In-Person
                        </button>
                        <button @onclick="@(() => AppointmentType = "Teleconsultation")"
                                class="px-4 py-2 rounded-lg border-2 transition-all @(AppointmentType == "Teleconsultation" ? "border-blue-500 bg-blue-500 text-white" : (IsDarkMode ? "border-gray-600 hover:border-gray-500" : "border-gray-300 hover:border-gray-400"))">
                            <i class="fas fa-video mr-2"></i>Online
                        </button>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 justify-end mt-6">
                <button @onclick="HandleClose"
                        class="px-4 py-2 @(IsDarkMode ? "bg-gray-700 hover:bg-gray-600" : "bg-gray-200 hover:bg-gray-300") rounded-lg transition-colors">
                    Cancel
                </button>
                <button @onclick="HandleSubmit"
                        disabled="@(string.IsNullOrEmpty(AppointmentReason))"
                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-paper-plane mr-2"></i>Request Appointment
                </button>
            </div>
        </div>
    </div>
}

@code {
    [Parameter]
    public bool IsVisible { get; set; }

    [Parameter]
    public string DoctorName { get; set; } = string.Empty;

    [Parameter]
    public string DoctorImage { get; set; } = string.Empty;

    [Parameter]
    public string DoctorSpecialty { get; set; } = string.Empty;

    [Parameter]
    public DateTime AppointmentDate { get; set; } = DateTime.Now.Date;

    [Parameter]
    public EventCallback<DateTime> AppointmentDateChanged { get; set; }

    [Parameter]
    public TimeSpan AppointmentTime { get; set; } = TimeSpan.Zero;

    [Parameter]
    public EventCallback<TimeSpan> AppointmentTimeChanged { get; set; }

    [Parameter]
    public string AppointmentReason { get; set; } = string.Empty;

    [Parameter]
    public EventCallback<string> AppointmentReasonChanged { get; set; }

    [Parameter]
    public string AppointmentType { get; set; } = "InPerson";

    [Parameter]
    public EventCallback<string> AppointmentTypeChanged { get; set; }

    [Parameter]
    public bool IsDarkMode { get; set; }

    [Parameter]
    public EventCallback OnSubmit { get; set; }

    [Parameter]
    public EventCallback OnClose { get; set; }

    private async Task HandleClose()
    {
        await OnClose.InvokeAsync();
    }

    private async Task HandleSubmit()
    {
        await OnSubmit.InvokeAsync();
    }

    private async Task HandleTimeChange(string value)
    {
        if (string.IsNullOrEmpty(value))
        {
            AppointmentTime = TimeSpan.Zero;
        }
        else
        {
            var parts = value.Split(':');
            if (parts.Length == 2 && int.TryParse(parts[0], out int hours) && int.TryParse(parts[1], out int minutes))
            {
                AppointmentTime = new TimeSpan(hours, minutes, 0);
            }
        }
        await AppointmentTimeChanged.InvokeAsync(AppointmentTime);
    }
}
